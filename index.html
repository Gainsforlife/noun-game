<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Noun Game ‚Äî Visible Progress Bar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="color-scheme" content="only light">
  <style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background: #fff !important;
  color-scheme: only light;
}
body {
  min-height: 100vh !important;
  background: #fff !important;
  color-scheme: only light;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100vw;
  padding: 0;
  overflow-x: hidden;
  overflow-y: auto;
}
.app-wrapper,
#game-container,
.game-content,
#content-wrapper,
#video-section,
#audio-cards,
.controls,
.app-header,
.points-display,
.score-marker {
  background: #fff !important;
}
#score-header {
  display: flex;
  gap: 2vw;
  align-items: center;
  justify-content: center;
  margin: 2vw auto 2vw auto;
  flex-wrap: wrap;
  width: 100vw;
  position: relative;
  background: #fff;
}
.score-marker {
  width: 9vw;
  height: 9vw;
  min-width: 26px;
  min-height: 26px;
  border: 2.5px solid #FFC100;
  background: #fff;
  border-radius: 2vw;
  margin: 0 1vw;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 6vw;
  color: #FFC100;
  box-shadow: 0 3px 10px #eed37a20;
  transition: background 0.2s;
}
.star-empty {
  opacity: 0.3;
  filter: grayscale(1);
}
.score-marker img {
  width: 80%; max-width: 32px; height: auto; object-fit: contain;
}
.app-header h1 { color: #191919; }
.app-header p { color: #424242; }
.points-display { background: #2563EB !important; color:#fff; padding:2vw 4vw; border-radius:2vw; font-weight:700; font-size:5vw; box-shadow:0 3px 10px rgba(102,126,234,.08);}
.points-label { font-size:3vw; text-transform:uppercase; letter-spacing:.09em;}
.points-value { font-size:8vw; font-weight:800; line-height:1;}
#game-container { width:100vw; flex:1; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:3vw; min-height:0;}
.game-content { width:100vw; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; justify-content:center;}
#content-wrapper { width:100vw; display:flex; flex-direction:column; align-items:center; justify-content:center;}
#video-section { position:relative; width:100vw; max-width:100vw; height:auto; margin:0 auto 3vw auto; box-sizing:border-box; display:flex; justify-content:center; align-items:center;}
#prompt-video { width:100vw; max-width:100vw; height:auto; display:block; background:#fff !important; border-radius:0; object-fit:contain; z-index:1; margin:0;}
#noun-img-container { position:absolute; top:2vw; right:2vw; z-index:2; width:50vw; height:auto; display:flex; justify-content:flex-end; align-items:flex-start; pointer-events:auto;}
.noun-img { width:100%; height:auto; max-width:100%; border-radius:4vw; padding:1vw; background:#f3f3f3 !important; border:2px solid #FF6B35; object-fit:contain; box-sizing:border-box; margin:0;}
.controls { width:94vw; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; margin-top:2vw; margin-bottom:2vw; flex-shrink:0;}
.btn-replay { padding:3vw 0; border-radius:2vw; border:none; width:74vw; background:#2563EB; color:#fff; font-size:6vw; font-weight:700; margin:0 auto; transition:background .3s; margin-bottom:2vw; box-shadow:0 4px 20px rgba(90,103,216,.08); letter-spacing:.05em;}
#audio-cards { width:100vw; display:flex; justify-content:center; gap:4vw; flex-wrap:wrap; padding-bottom:2vw;}
.audio-card { display:flex; flex-direction:row; align-items:center; justify-content:center; gap:2vw; padding:4vw 5vw; border-radius:2vw; background:#f3f3f3 !important; box-shadow:0 4px 20px rgba(102,126,234,.04); cursor:grab; border:3px solid #2563EB; font-size:5vw; color:#222; font-weight:700; min-width:34vw; max-width:43vw; text-align:center; margin-bottom:2vw; user-select:none; -webkit-user-select:none; transition:box-shadow .2s,border-color .2s;}
.audio-card span { font-size:4vw; text-transform:uppercase; font-family:inherit; font-weight:700; letter-spacing:.05em; margin-right:1vw;}
.audio-card button { background:rgba(60,60,60,.08); border:2px solid #2563EB; border-radius:50%; width:9vw; height:9vw; font-size:6vw; cursor:pointer; display:flex; align-items:center; justify-content:center; color:#2563EB; margin-left:.5vw; margin-right:.5vw; transition:background .2s;}
.audio-card button:active { background:rgba(60,60,60,.14);}
.audio-card:active, .audio-card.touching { box-shadow:0 8px 30px rgba(102,126,234,.07); border-color:#2563EB; opacity:0.92;}
.audio-card.dragging { opacity:0.8; box-shadow:0 12px 40px rgba(102,126,234,.07);}
.drag-clone { background: #f3f3f3 !important; position: fixed; pointer-events: none; z-index: 9999; opacity: 0.9; box-shadow: 0 18px 40px #aaa; transform: scale(1.08) rotate(2deg); transition: none; }
@media (min-width:700px) {
  .app-header, .game-content, #content-wrapper, #video-section, #prompt-video, body, html, .app-wrapper { background: #fff !important; }
}
  </style>
</head>
<body>
  <div class="app-wrapper">
    <div class="app-header">
      <h1>üéÆ Noun Game</h1>
      <p>Drag the correct audio card to match the image</p>
    </div>
    <div id="score-header"></div>
    <div id="game-container">
      <div class="game-content">
        <div id="content-wrapper">
          <div id="video-section">
            <video id="prompt-video" autoplay playsinline></video>
            <div id="noun-img-container">
              <img id="noun-img" class="noun-img" src="" alt="noun">
            </div>
          </div>
        </div>
      </div>
      <div class="controls">
        <button class="btn-replay" onclick="playPromptVideo()">REPLAY VIDEO</button>
      </div>
      <div id="audio-cards"></div>
    </div>
  </div>
  <script>
    // Data and config
    const nouns = [
      { name: 'butterfly', img: 'img/Butterfly.png', audio: 'audio/butterfly.mp3' },
      { name: 'duck', img: 'img/duck.png', audio: 'audio/duck.mp3' },
      { name: 'turtle', img: 'img/turtle.png', audio: 'audio/turtle.mp3' },
      { name: 'frog', img: 'img/frog.png', audio: 'audio/frog.mp3' },
      { name: 'dolphin', img: 'img/dolphin.png', audio: 'audio/dolphin.mp3' },
      { name: 'fish', img: 'img/fish.png', audio: 'audio/fish.mp3' },
      { name: 'bee', img: 'img/bee.png', audio: 'audio/bee.mp3' },
      { name: 'plane', img: 'img/plane.png', audio: 'audio/plane.mp3' },
      { name: 'bat', img: 'img/bat.png', audio: 'audio/bat.mp3' },
      { name: 'bird', img: 'img/bird.png', audio: 'audio/bird.mp3' }
    ];
    const whatisthisVideos = [
      'vid/whatisthis.mp4',
      'vid/whatisthis1.mp4',
      'vid/whatisthis2.mp4'
    ];
    let videoQueue = [];
    let lastVideo = null;
    const streakLength = 5; // Change this for longer progress bars!
    const pointsGoal = streakLength; // For demo, win after filling the bar
    let streak = 0;
    let totalPoints = 0;
    let scoreMarkers = [];
    let gameWon = false;
    let celebrationInProgress = false;

    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
    function getNextWhatisthisVideo() {
      if (videoQueue.length <= 1) {
        videoQueue = shuffleArray(whatisthisVideos);
        if (videoQueue[0] === lastVideo && videoQueue.length > 1) {
          [videoQueue[0], videoQueue[1]] = [videoQueue[1], videoQueue[0]];
        }
      }
      lastVideo = videoQueue[0];
      return videoQueue.shift();
    }
    function setupScoreHeader() {
      const header = document.getElementById('score-header');
      header.innerHTML = '';
      scoreMarkers = [];
      for (let i = 0; i < streakLength; i++) {
        const div = document.createElement('div');
        div.className = 'score-marker';
        // Progress bar always starts with empty star
        div.innerHTML = '<span class="star-empty">‚≠ê</span>';
        header.appendChild(div);
        scoreMarkers.push(div);
      }
      const pointsDiv = document.createElement('div');
      pointsDiv.className = 'points-display';
      pointsDiv.innerHTML = `<div class="points-label">Points</div><div class="points-value" id="points-counter">0</div>`;
      header.appendChild(pointsDiv);
      document.getElementById('points-counter').textContent = totalPoints;
      // Re-fill stars after DOM update
      for (let i=0; i<streak; ++i) scoreMarkers[i].innerHTML = '‚≠ê';
    }
    function animateStarToProgressBar(targetMarkerIndex) {
      scoreMarkers[targetMarkerIndex].innerHTML = '‚≠ê';
    }
    function removeLastStar() {
      for (let i = streakLength-1; i >= 0; i--) {
        if (scoreMarkers[i].innerHTML !== '<span class=\"star-empty\">‚≠ê</span>' && scoreMarkers[i].innerHTML !== '') {
          scoreMarkers[i].innerHTML = '<span class="star-empty">‚≠ê</span>';
          break;
        }
      }
    }
    function resetGame() {
      gameWon = false;
      celebrationInProgress = false;
      totalPoints = 0;
      streak = 0;
      document.querySelector('.app-header').classList.remove('hidden');
      document.getElementById('score-header').classList.remove('hidden');
      document.querySelector('.controls').classList.remove('hidden');
      document.getElementById('audio-cards').classList.remove('hidden');
      document.getElementById('noun-img-container').classList.remove('hidden');
      setupScoreHeader();
      loadNewRound();
    }
    function playCelebration() {
      gameWon = true;
      celebrationInProgress = true;
      document.querySelector('.app-header').classList.add('hidden');
      document.getElementById('score-header').classList.add('hidden');
      document.querySelector('.controls').classList.add('hidden');
      document.getElementById('audio-cards').classList.add('hidden');
      document.getElementById('noun-img-container').classList.add('hidden');
      setTimeout(() => { resetGame(); }, 2000);
    }
    function updateScoreHeader(isCorrect) {
      if (gameWon || celebrationInProgress) return;
      if (isCorrect) {
        animateStarToProgressBar(streak);
        streak++;
        if (streak === streakLength) {
          totalPoints++;
          updatePointsDisplay();
          if (totalPoints === pointsGoal) {
            playCelebration();
            return;
          } else {
            streak = 0;
            setTimeout(() => { setupScoreHeader(); }, 600);
          }
        }
      } else if (streak > 0) {
        removeLastStar();
        streak--;
      }
    }
    function updatePointsDisplay() {
      const pointsCounter = document.getElementById('points-counter');
      if (pointsCounter)
        pointsCounter.textContent = totalPoints;
    }
    function loadNewRound() {
      if (gameWon || celebrationInProgress) return;
      const noun = nouns[Math.floor(Math.random() * nouns.length)];
      document.getElementById('noun-img').src = noun.img;
      document.getElementById('noun-img').setAttribute('data-noun', noun.name);
      const video = document.getElementById('prompt-video');
      video.src = getNextWhatisthisVideo();
      video.loop = false;
      video.play().catch(()=>{});
      let incorrect;
      do { incorrect = nouns[Math.floor(Math.random() * nouns.length)]; }
      while (incorrect.name === noun.name);
      let audioCards = [
        { name: noun.name, audio: noun.audio, correct: true },
        { name: incorrect.name, audio: incorrect.audio, correct: false }
      ];
      audioCards.sort(() => Math.random() - 0.5);
      const audioCardsDiv = document.getElementById('audio-cards');
      audioCardsDiv.innerHTML = '';
      audioCards.forEach((card) => {
        const div = document.createElement('div');
        div.className = 'audio-card';
        div.setAttribute('draggable', true);
        div.setAttribute('data-correct', card.correct);
        div.innerHTML = `<span>${card.name}</span>
          <button onclick="event.stopPropagation(); playAudio('${card.audio}')">üîà</button>`;
        div.addEventListener('dragstart', function(e){
          if (gameWon || celebrationInProgress) { e.preventDefault(); return; }
          e.dataTransfer.setData('text/plain', card.correct);
          div.classList.add('dragging');
        });
        div.addEventListener('dragend', function(e){ div.classList.remove('dragging'); });
        audioCardsDiv.appendChild(div);
      });
      let nounImg = document.getElementById('noun-img');
      nounImg.ondragover = e => e.preventDefault();
      nounImg.ondrop = function(e){
        e.preventDefault();
        if (gameWon || celebrationInProgress) return;
        const correct = (e.dataTransfer.getData('text/plain') === 'true');
        if (correct) playFeedback(true);
        else { updateScoreHeader(false); playFeedback(false);}
      };
      // Fill stars initial
      for (let i = 0; i < streak; ++i) animateStarToProgressBar(i);
    }
    function playAudio(audioPath) {
      if (gameWon || celebrationInProgress) return;
      const audio = new Audio(audioPath);
      audio.play();
    }
    function playPromptVideo() {
      if (gameWon || celebrationInProgress) return;
      const vid = document.getElementById('prompt-video');
      vid.currentTime = 0;
      vid.play();
    }
    function playFeedback(isCorrect) {
      if (gameWon || celebrationInProgress) return;
      const promptVideo = document.getElementById('prompt-video');
      promptVideo.src = isCorrect ? 'vid/thatscorrect.mp4' : 'vid/betterluck.mp4';
      promptVideo.loop = false;
      promptVideo.onended = null;
      promptVideo.onended = function() {
        if (!gameWon && !celebrationInProgress) {
          promptVideo.onended = null;
          if (isCorrect) updateScoreHeader(true);
          setTimeout(loadNewRound, 500);
        }
      };
      promptVideo.play().catch(()=>{});
    }

    // --- TOUCH DRAG SUPPORT WITH DRAG CLONE ---
    let touchItem = null;
    let dragClone = null;
    document.addEventListener('touchstart', function(e) {
      const card = e.target.closest('.audio-card');
      if (card && !(gameWon || celebrationInProgress)) {
        touchItem = card;
        card.classList.add('touching');
        dragClone = card.cloneNode(true);
        dragClone.className = "audio-card drag-clone";
        dragClone.style.width = card.offsetWidth + "px";
        dragClone.style.height = card.offsetHeight + "px";
        document.body.appendChild(dragClone);
        const touch = e.touches[0];
        dragClone.style.left = (touch.clientX - card.offsetWidth/2) + "px";
        dragClone.style.top = (touch.clientY - card.offsetHeight/2) + "px";
      }
    },{passive:false});
    document.addEventListener('touchmove', function(e) {
      if (dragClone && touchItem) {
        e.preventDefault();
        const touch = e.touches[0];
        dragClone.style.left = (touch.clientX - dragClone.offsetWidth/2) + "px";
        dragClone.style.top = (touch.clientY - dragClone.offsetHeight/2) + "px";
      }
    },{passive:false});
    document.addEventListener('touchend', function(e) {
      if (dragClone) dragClone.remove();
      dragClone = null;
      const touch = e.changedTouches[0];
      const nounImg = document.getElementById('noun-img');
      const rect = nounImg.getBoundingClientRect();
      if (
        touchItem &&
        touch.clientX >= rect.left && touch.clientX <= rect.right &&
        touch.clientY >= rect.top && touch.clientY <= rect.bottom
      ) {
        const correct = (touchItem.getAttribute('data-correct') === 'true');
        if (correct) playFeedback(true);
        else { updateScoreHeader(false); playFeedback(false);}
      }
      if (touchItem) touchItem.classList.remove('touching');
      touchItem = null;
    },{passive:false});

    setupScoreHeader();
    loadNewRound();
  </script>
</body>
</html>
