<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Noun Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <style>
    html, body {height:100%;margin:0;padding:0;}
    body {
      min-height:100vh;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      display:flex;align-items:center;justify-content:center;width:100vw;padding:0;overflow:hidden;
    }
    .app-wrapper {
      background:#23243A;border-radius:20px;max-width:100vw;width:100vw;min-height:100vh;height:100vh;
      margin:0;padding:0;display:flex;flex-direction:column;align-items:center;overflow:hidden;
    }
    .app-header { text-align: center; padding: 2vw 0; width: 100vw;}
    .app-header h1 { font-size:7vw; color:#fff; margin-bottom:.5vw; letter-spacing:.05em;}
    .app-header p { color:#ccc; font-size:4vw; margin-top:1vw;}
    #score-header {
      display:flex; gap:4vw; align-items:center; justify-content:center; margin:2vw auto;
      flex-wrap:wrap;width:86vw; position:relative; flex-shrink:0;
    }
    .game-content {width:100vw; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; justify-content:center;}
    #content-wrapper { width:100vw; display:flex; flex-direction:column; align-items:center; justify-content:center;}
    #video-section {
      position:relative;
      width:100vw;
      max-width:100vw;
      height:auto;
      margin:0 auto 3vw auto;
      box-sizing:border-box;
      display:flex; justify-content:center; align-items:center;
      background:none;
    }
    /* Video is always fullwidth */
    #prompt-video {
      width:100vw;max-width:100vw;height:auto;display:block; background:#101223;border-radius:0;object-fit:contain;z-index:1;margin:0;
    }
    /* Noun image overlays and scales to 50% video width */
    #noun-img-container {
      position:absolute;
      top:2vw; /* Distance from video top */
      right:2vw; /* Distance from video right */
      z-index:2;
      width:50vw; /* 50% of video width */
      height:auto;
      display:flex;
      justify-content:flex-end;
      align-items:flex-start;
      pointer-events:auto;
    }
    .noun-img {
      width:100%;height:auto;max-width:100%;border-radius:4vw;padding:1vw;background:#3E3F50;
      border:2px solid #FF6B35; object-fit:contain; box-sizing:border-box; margin:0;
      box-shadow:0 6px 32px rgba(0,0,0,0.7);
    }
    @media (min-width:700px) {
      #video-section { height:auto; max-width:70vw;}
      #prompt-video { width:70vw; height:auto; }
      #noun-img-container { width:35vw;top:1vw;right:1vw;} /* 50% bigger for desktop */
    }
    /* rest of your CSS unchanged... */
    .controls{width:94vw;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;margin-top:2vw;margin-bottom:2vw;flex-shrink:0;}
    .btn-replay{padding:3vw 0;border-radius:2vw;border:none;width:74vw;background:#2463EB;color:#fff;font-size:6vw;font-weight:700;margin:0 auto;transition:background .3s;margin-bottom:2vw;box-shadow:0 4px 20px rgba(90,103,216,.3);letter-spacing:.05em;}
    #audio-cards{width:100vw;display:flex;justify-content:center;gap:4vw;flex-wrap:wrap;padding-bottom:2vw;}
    .audio-card{display:flex;flex-direction:row;align-items:center;justify-content:center;gap:2vw;padding:4vw 5vw;border-radius:2vw;background:#232F48;box-shadow:0 4px 20px rgba(102,126,234,.4);cursor:grab;border:3px solid #2563EB;font-size:5vw;color:#fff;font-weight:700;min-width:34vw;max-width:43vw;text-align:center;margin-bottom:2vw;user-select:none;-webkit-user-select:none;transition:box-shadow .2s,border-color .2s;}
    .audio-card span{font-size:4vw;text-transform:uppercase;font-family:inherit;font-weight:700;letter-spacing:.05em;margin-right:1vw;}
    .audio-card button{background:rgba(255,255,255,.13);border:2px solid #fff;border-radius:50%;width:9vw;height:9vw;font-size:6vw;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;margin-left:.5vw;margin-right:.5vw;transition:background .2s;}
    .audio-card button:active{background:rgba(255,255,255,.28);}
    .audio-card:active,.audio-card.touching{box-shadow:0 8px 30px rgba(102,126,234,.8);border-color:#fff;opacity:.85;}
    .audio-card.dragging{opacity:.7;box-shadow:0 12px 40px rgba(102,126,234,.9;}
  </style>
</head>
<body>
  <div class="app-wrapper">
    <div class="app-header">
      <h1>ðŸŽ® Noun Game</h1>
      <p>Drag the correct audio card to match the image</p>
    </div>
    <div id="score-header"></div>
    <div id="game-container">
      <div class="game-content">
        <div id="content-wrapper">
          <div id="video-section">
            <video id="prompt-video" controls autoplay playsinline muted></video>
            <div id="noun-img-container">
              <img id="noun-img" class="noun-img" src="" alt="noun">
            </div>
          </div>
        </div>
      </div>
      <div class="controls">
        <button class="btn-replay" onclick="playPromptVideo()">REPLAY VIDEO</button>
      </div>
      <div id="audio-cards"></div>
    </div>
  </div>
  <script>
    // Your usual game JS unchanged:
    const nouns = [
      { name: 'butterfly', img: 'img/Butterfly.png', audio: 'audio/butterfly.mp3' },
      { name: 'duck', img: 'img/duck.png', audio: 'audio/duck.mp3' },
      { name: 'turtle', img: 'img/turtle.png', audio: 'audio/turtle.mp3' },
      { name: 'frog', img: 'img/frog.png', audio: 'audio/frog.mp3' },
      { name: 'dolphin', img: 'img/dolphin.png', audio: 'audio/dolphin.mp3' },
      { name: 'fish', img: 'img/fish.png', audio: 'audio/fish.mp3' },
      { name: 'bee', img: 'img/bee.png', audio: 'audio/bee.mp3' },
      { name: 'plane', img: 'img/plane.png', audio: 'audio/plane.mp3' },
      { name: 'bat', img: 'img/bat.png', audio: 'audio/bat.mp3' },
      { name: 'bird', img: 'img/bird.png', audio: 'audio/bird.mp3' }
    ];
    const whatisthisVideos = [
      'vid/whatisthis.mp4',
      'vid/whatisthis1.mp4',
      'vid/whatisthis2.mp4'
    ];
    let videoQueue = [];
    let lastVideo = null;
    const streakLength = 1;
    const pointsGoal = 1;
    let streak = 0;
    let totalPoints = 0;
    let scoreMarkers = [];
    let gameWon = false;
    let celebrationInProgress = false;

    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
    function getNextWhatisthisVideo() {
      if (videoQueue.length <= 1) {
        videoQueue = shuffleArray(whatisthisVideos);
        if (videoQueue[0] === lastVideo && videoQueue.length > 1) {
          [videoQueue[0], videoQueue[1]] = [videoQueue[1], videoQueue[0]];
        }
      }
      lastVideo = videoQueue[0];
      return videoQueue.shift();
    }
    function setupScoreHeader() {
      const header = document.getElementById('score-header');
      header.innerHTML = '';
      scoreMarkers = [];
      for (let i = 0; i < streakLength; i++) {
        const div = document.createElement('div');
        div.className = 'score-marker';
        div.innerHTML = '';
        header.appendChild(div);
        scoreMarkers.push(div);
      }
      const pointsDiv = document.createElement('div');
      pointsDiv.className = 'points-display';
      pointsDiv.innerHTML = `<div class="points-label">Points</div><div class="points-value" id="points-counter">0</div>`;
      header.appendChild(pointsDiv);
      document.getElementById('points-counter').textContent = totalPoints;
    }
    function animateStarToProgressBar(targetMarkerIndex) {
      const nounImg = document.getElementById('noun-img');
      const nounRect = nounImg.getBoundingClientRect();
      const startX = nounRect.left + nounRect.width / 2;
      const startY = nounRect.top + nounRect.height / 2;
      const targetMarker = scoreMarkers[targetMarkerIndex];
      const targetRect = targetMarker.getBoundingClientRect();
      const endX = targetRect.left + targetRect.width / 2;
      const endY = targetRect.top + targetRect.height / 2;
      setTimeout(() => { targetMarker.innerHTML = '<img src="img/star.png" width="40">'; }, 600);
    }
    function removeLastStar() {
      for (let i = scoreMarkers.length - 1; i >= 0; i--) {
        const marker = scoreMarkers[i];
        if (marker.innerHTML.trim() !== '') {
          marker.innerHTML = '';
          break;
        }
      }
    }
    function resetGame() {
      gameWon = false; celebrationInProgress = false; totalPoints = 0; streak = 0;
      document.querySelector('.app-header').classList.remove('hidden');
      document.querySelector('#score-header').classList.remove('hidden');
      document.querySelector('.controls').classList.remove('hidden');
      document.querySelector('#audio-cards').classList.remove('hidden');
      document.querySelector('#noun-img-container').classList.remove('hidden');
      setupScoreHeader(); loadNewRound();
    }
    function playCelebration() {
      gameWon = true; celebrationInProgress = true;
      document.querySelector('.app-header').classList.add('hidden');
      document.querySelector('#score-header').classList.add('hidden');
      document.querySelector('.controls').classList.add('hidden');
      document.querySelector('#audio-cards').classList.add('hidden');
      document.querySelector('#noun-img-container').classList.add('hidden');
      setTimeout(() => { resetGame(); }, 2000);
    }
    function updateScoreHeader(isCorrect) {
      if (gameWon || celebrationInProgress) return;
      if (isCorrect) {
        streak++; animateStarToProgressBar(streak - 1);
        if (streak === streakLength) {
          totalPoints++; updatePointsDisplay();
          if (totalPoints === pointsGoal) { playCelebration(); return; }
          else { streak = 0; setTimeout(() => { setupScoreHeader(); }, 600); }
        }
      } else { if (streak > 0) { removeLastStar(); streak--; } }
    }
    function updatePointsDisplay() {
      const pointsCounter = document.getElementById('points-counter');
      if (pointsCounter) pointsCounter.textContent = totalPoints;
    }
    function loadNewRound() {
      if (gameWon || celebrationInProgress) return;
      const noun = nouns[Math.floor(Math.random() * nouns.length)];
      document.getElementById('noun-img').src = noun.img;
      document.getElementById('noun-img').setAttribute('data-noun', noun.name);
      const video = document.getElementById('prompt-video');
      video.src = getNextWhatisthisVideo();
      video.loop = false;
      video.play().catch(()=>{});
      let incorrect;
      do {
        incorrect = nouns[Math.floor(Math.random() * nouns.length)];
      } while (incorrect.name === noun.name);
      let audioCards = [
        { name: noun.name, audio: noun.audio, correct: true },
        { name: incorrect.name, audio: incorrect.audio, correct: false }
      ];
      audioCards.sort(() => Math.random() - 0.5);
      const audioCardsDiv = document.getElementById('audio-cards');
      audioCardsDiv.innerHTML = '';
      audioCards.forEach((card) => {
        const div = document.createElement('div');
        div.className = 'audio-card';
        div.setAttribute('draggable', true);
        div.setAttribute('data-correct', card.correct);
        div.innerHTML = `<span>${card.name}</span>
          <button onclick="event.stopPropagation(); playAudio('${card.audio}')">ðŸ”ˆ</button>`;
        div.addEventListener('dragstart', function(e){
          if (gameWon || celebrationInProgress) { e.preventDefault(); return; }
          e.dataTransfer.setData('text/plain', card.correct);
          div.classList.add('dragging');
        });
        div.addEventListener('dragend', function(e){ div.classList.remove('dragging'); });
        audioCardsDiv.appendChild(div);
      });
      let nounImg = document.getElementById('noun-img');
      nounImg.ondragover = e => e.preventDefault();
      nounImg.ondrop = function(e){
        e.preventDefault();
        if (gameWon || celebrationInProgress) return;
        const correct = (e.dataTransfer.getData('text/plain') === 'true');
        if (correct) playFeedback(true);
        else { updateScoreHeader(false); playFeedback(false);}
      };
    }
    function playAudio(audioPath) {
      if (gameWon || celebrationInProgress) return;
      const audio = new Audio(audioPath);
      audio.play();
    }
    function playPromptVideo() {
      if (gameWon || celebrationInProgress) return;
      const vid = document.getElementById('prompt-video');
      vid.currentTime = 0;
      vid.play();
    }
    function playFeedback(isCorrect) {
      if (gameWon || celebrationInProgress) return;
      const promptVideo = document.getElementById('prompt-video');
      promptVideo.src = isCorrect ? 'vid/thatscorrect.mp4' : 'vid/betterluck.mp4';
      promptVideo.loop = false;
      promptVideo.onended = null;
      promptVideo.onended = function() {
        if (!gameWon && !celebrationInProgress) {
          promptVideo.onended = null;
          if (isCorrect) updateScoreHeader(true);
          setTimeout(loadNewRound, 500);
        }
      };
      promptVideo.play().catch(()=>{});
    }
    // MOBILE TOUCH DRAG
    let touchItem = null;
    document.addEventListener('touchstart', function(e) {
      const card = e.target.closest('.audio-card');
      if (card && !(gameWon || celebrationInProgress)) {
        touchItem = card;
        card.classList.add('touching');
      }
    },{passive:true});
    document.addEventListener('touchend', function(e) {
      if (!touchItem) return;
      const touch = e.changedTouches[0];
      const nounImg = document.getElementById('noun-img');
      const rect = nounImg.getBoundingClientRect();
      if (
        touch.clientX >= rect.left && touch.clientX <= rect.right &&
        touch.clientY >= rect.top && touch.clientY <= rect.bottom
      ) {
        const correct = (touchItem.getAttribute('data-correct') === 'true');
        if (correct) playFeedback(true);
        else { updateScoreHeader(false); playFeedback(false);}
      }
      touchItem.classList.remove('touching');
      touchItem = null;
    },{passive:true});
    setupScoreHeader();
    loadNewRound();
  </script>
</body>
</html>
